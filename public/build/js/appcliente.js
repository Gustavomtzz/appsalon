function eventListeners(){consultarAPI(),mostrarSeccion(),tabClikeado(),paginaAnterior(),paginaSiguiente(),nombreCliente(),idCliente(),seleccionarFecha(),seleccionarHora()}document.addEventListener("DOMContentLoaded",(function(){eventListeners()}));let paso=1;const pasoInicial=1,pasoFinal=3,cita={id:null,nombre:"",fecha:"",hora:"",servicios:[]};async function consultarAPI(){try{const e=location.origin+"/api/servicios",t=await fetch(e);mostrarServicios(await t.json())}catch(e){console.log(e)}}function tabClikeado(){document.querySelectorAll(".tabs Button").forEach(e=>{e.addEventListener("click",e=>{paso=parseInt(e.target.dataset.paso),mostrarSeccion(),paginadorAgregaroQuitar()})})}function mostrarSeccion(){const e=document.querySelector(".mostrar"),t=document.querySelector(".actual");(e||t)&&e.classList.remove("mostrar"),t&&t.classList.remove("actual");const a="#paso-"+paso,r=`[data-paso="${paso}"]`,o=document.querySelector(a),c=document.querySelector(r);o.classList.add("mostrar"),c.classList.add("actual"),"#paso-3"==a&&mostrarResumen()}function paginadorAgregaroQuitar(){const e=document.querySelector("#anterior"),t=document.querySelector("#siguiente"),a={1:(e,t)=>{t.classList.remove("ocultar"),e.classList.add("ocultar")},2:(e,t)=>{t.classList.remove("ocultar"),e.classList.remove("ocultar")},3:(e,t)=>{e.classList.remove("ocultar"),t.classList.add("ocultar")}};a[paso](e,t)}function paginaSiguiente(){document.querySelector("#siguiente").addEventListener("click",()=>{paso<3&&(paso++,paginadorAgregaroQuitar(),mostrarSeccion())})}function paginaAnterior(){document.querySelector("#anterior").addEventListener("click",()=>{paso>1&&(paso--,paginadorAgregaroQuitar(),mostrarSeccion())})}function mostrarServicios(e){const t=document.querySelector("#servicios");for(let a in e){const{id:r,nombre:o,precio:c}=e[a],n=document.createElement("P");n.classList.add("nombre-servicio"),n.textContent=o;const i=document.createElement("P");i.classList.add("precio-servicio"),i.textContent="$"+c;const s=document.createElement("DIV");s.classList.add("servicio"),s.dataset.idServicio=r,s.onclick=function(){seleccionarServicio(e[a])},s.appendChild(n),s.appendChild(i),t.appendChild(s)}}function seleccionarServicio(e){const{servicios:t}=cita,a=e.id;t.some(e=>e.id===a)?(cita.servicios=t.filter(e=>e.id!==a),cambiarEstiloServicioSelect(a)):(cambiarEstiloServicioSelect(a),cita.servicios=[...t,e])}function cambiarEstiloServicioSelect(e){document.querySelector(`[data-id-servicio="${e}"]`).classList.toggle("seleccionado")}function idCliente(){const e=document.querySelector("#id").value;cita.id=e}function nombreCliente(){const e=document.querySelector("#nombre").value;cita.nombre=e.trim()}function seleccionarFecha(){document.querySelector("#fecha").addEventListener("change",e=>{const t=new Date(e.target.value).getUTCDay();[6,0].includes(t)?(e.target.value="",mostrarAlerta("Sabados y Domingos cerrado","error","#divAlerta")):(borrarAlerta(),cita.fecha=e.target.value)})}function seleccionarHora(){document.querySelector("#hora").addEventListener("input",e=>{const t=e.target.value.split(":")[0];t>=20||t<10?(e.target.value="",cita.hora="",mostrarAlerta("Hora no VÃ¡lida","error","#divAlerta")):(borrarAlerta(),cita.hora=e.target.value)})}function mostrarAlerta(e,t,a){const r=document.querySelector(a);borrarAlerta(),alerta=document.createElement("P"),alerta.id="alerta",alerta.classList.add("alerta-"+t,"text-center"),alerta.textContent=e,r.appendChild(alerta)}function borrarAlerta(){const e=document.querySelector("#alerta");e&&e.remove()}function mostrarResumen(){const e=document.querySelector("#resumen");if(Object.values(cita).includes("")||0===cita.servicios.length)return void mostrarAlerta("Datos Incompletos","error","#divAlerta-resumen");const t=formatearFecha(cita.fecha);e.innerHTML=`\n        <p><span class="nombre">Nombre:</span> ${cita.nombre}</p>\n        <p><span class="nombre">Fecha:</span> ${t}</p>\n        <p><span class="nombre">Hora:</span> ${cita.hora}</p=>\n        `,cita.servicios.forEach(t=>{Servicio=document.createElement("P"),Servicio.classList.add("resumen","servicio"),Servicio.innerHTML=`<span>${t.nombre}</span><br>\n        <span class="precio">Precio:</span> $${t.precio}`,Servicio.dataset.id=t.id,e.appendChild(Servicio)});const a=document.createElement("BUTTON");a.classList.add("boton"),a.textContent="Reservar Cita",a.onclick=reservarCita,e.appendChild(a)}function formatearFecha(e){const t=new Date(e),a=t.getDate()+2,r=t.getMonth(),o=t.getFullYear();return new Date(Date.UTC(o,r,a)).toLocaleDateString("es-AR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}async function reservarCita(){const{id:e,fecha:t,hora:a,servicios:r}=cita,o=r.map(e=>e.id),c=new FormData;c.append("fecha",t),c.append("hora",a),c.append("usuarioId",parseInt(e)),c.append("servicios",o);try{const e=location.origin+"/api/citas",t=await fetch(e,{method:"POST",body:c});(await t.json()).resultado&&Swal.fire({icon:"success",title:"Cita Creada",text:"Tu cita fue creada correctamente",button:"OK"}).then(()=>{window.location.reload()})}catch(e){Swal.fire({icon:"error",title:"Hubo un Error",text:"Tu cita no pudo ser guardada",button:"Cerrar"})}}